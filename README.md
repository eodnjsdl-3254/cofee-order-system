# TDD κΈ°λ° μ»¤ν”Όμ μ£Όλ¬Έ/ν¬μΈνΈ μ‹μ¤ν… λ°±μ—”λ“ API

## π€ ν”„λ΅μ νΈ μ†κ°

μ΄ ν”„λ΅μ νΈλ” TDD(Test-Driven Development) λ°©λ²•λ΅ μ„ μ μ©ν•μ—¬ κ°λ°λ μ»¤ν”Όμ μ£Όλ¬Έ λ° ν¬μΈνΈ κ΄€λ¦¬ μ‹μ¤ν…μ λ°±μ—”λ“ APIμ…λ‹λ‹¤. μ‚¬μ©μκ°€ μ»¤ν”Ό λ©”λ‰΄λ¥Ό μ΅°νν•κ³ , μ£Όλ¬Έ λ° κ²°μ λ¥Ό ν•λ©°, ν¬μΈνΈλ¥Ό μ¶©μ „ν•  μ μλ” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. λ‚™κ΄€μ  λ½μ„ ν†µν• λ™μ‹μ„± μ μ–΄μ™€ μΈκΈ° λ©”λ‰΄ μ΅°ν κΈ°λ¥μ΄ κµ¬ν„λμ—μµλ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥

* **λ©”λ‰΄ μ΅°ν**: ν„μ¬ νλ§¤ μ¤‘μΈ μ»¤ν”Ό λ©”λ‰΄ λ©λ΅μ„ μ΅°νν•©λ‹λ‹¤.
* **λ‹¨μΌ λ©”λ‰΄ μ΅°ν**: νΉμ • λ©”λ‰΄μ μƒμ„Έ μ •λ³΄λ¥Ό μ΅°νν•©λ‹λ‹¤.
* **μΈκΈ° λ©”λ‰΄ μ΅°ν**: μµκ·Ό 7μΌκ°„ κ°€μ¥ λ§μ΄ μ£Όλ¬Έλ λ©”λ‰΄ λ©λ΅μ„ μ΅°νν•©λ‹λ‹¤.
* **μ£Όλ¬Έ λ° κ²°μ **: λ³΄μ  ν¬μΈνΈλ΅ μ»¤ν”Όλ¥Ό μ£Όλ¬Έν•κ³  κ²°μ ν•©λ‹λ‹¤. (λ‚™κ΄€μ  λ½μ„ ν†µν• λ™μ‹μ„± μ μ–΄ ν¬ν•¨)
* **ν¬μΈνΈ μ¶©μ „**: μ‚¬μ©μμ ν¬μΈνΈλ¥Ό μ¶©μ „ν•©λ‹λ‹¤. (λ‚™κ΄€μ  λ½μ„ ν†µν• λ™μ‹μ„± μ μ–΄ ν¬ν•¨)
* **λ™μ‹μ„± ν…μ¤νΈ**: μ—¬λ¬ μ‚¬μ©μκ°€ λ™μ‹μ— μ£Όλ¬Έ λ° ν¬μΈνΈ μ¶©μ „ μ‹ μ‹μ¤ν…μ λ™μ‹μ„± μ²λ¦¬ λ¥λ ¥μ„ κ²€μ¦ν•©λ‹λ‹¤.

## π› οΈ κΈ°μ  μ¤νƒ

* **μ–Έμ–΄**: Java 17
* **ν”„λ μ„μ›ν¬**: Spring Boot 3.3.13
* **λΉλ“ λ„κµ¬**: Maven
* **λ°μ΄ν„°λ² μ΄μ¤**: H2 Database (μΈλ©”λ¨λ¦¬)
* **ORM**: Spring Data JPA, Hibernate
* **ν…μ¤νΈ**: JUnit5, Mockito
* **λ™μ‹μ„± μ μ–΄**: λ‚™κ΄€μ  λ½ (`@Version`)

---

## π“ API λ…μ„Έ

### 1. λ©”λ‰΄ λ©λ΅ μ΅°ν

* **GET** `/api/menus`
* **μ‘λ‹µ μμ‹:**
    ```json
    [
      { "id": 1, "menuName": "μ•„λ©”λ¦¬μΉ΄λ…Έ", "price": 3000 },
      { "id": 2, "menuName": "μΉ΄ν λΌλ–Ό", "price": 4000 }
    ]
    ```

### 2. λ‹¨μΌ λ©”λ‰΄ μ΅°ν

* **GET** `/api/menus/{id}`
* **μ‘λ‹µ μμ‹:**
    ```json
    { "id": 1, "name": "μ•„λ©”λ¦¬μΉ΄λ…Έ", "price": 3000 }
    ```
    *(μ°Έκ³ : `MenuController`μ—μ„ `Menu` μ—”ν‹°ν‹°λ¥Ό μ§μ ‘ λ°ν™ν•©λ‹λ‹¤.)*

### 3. μΈκΈ° λ©”λ‰΄ λ©λ΅ μ΅°ν

* **GET** `/api/menus/popular`
* **μ‘λ‹µ μμ‹:**
    ```json
    [
      { "id": 16, "menuName": "μ•„λ©”λ¦¬μΉ΄λ…Έ", "price": 3000, "orderCount": 6 }
      // μ‹¤μ  IDμ™€ μ£Όλ¬Έ νμλ” ν…μ¤νΈ κ²°κ³Όμ— λ”°λΌ λ‹¬λΌμ§ μ μμµλ‹λ‹¤.
    ]
    ```

### 4. μ»¤ν”Ό μ£Όλ¬Έ λ° κ²°μ 

* **POST** `/api/orders`
* **μ”μ²­ μμ‹:**
    ```json
    {
      "userId": "user001",
      "menuId": 1,
      "quantity": 2
    }
    ```
* **μ‘λ‹µ μμ‹:**
    ```json
    {
      "orderId": "c73b1767-dfb4-4777-bd47-2a0602801a81",
      "userId": "user001",
      "menuId": 1,
      "menuName": "μ•„λ©”λ¦¬μΉ΄λ…Έ",
      "quantity": 2,
      "totalPrice": 8000,
      "remainingPoints": 12000,
      "status": "COMPLETED",
      "orderDate": "2025-06-25T11:00:00.123456"
    }
    ```

### 5. ν¬μΈνΈ μ¶©μ „

* **POST** `/api/user/points/charge`
* **μ”μ²­ μμ‹:**
    ```json
    {
      "userId": "testUser1",
      "amount": 10000
    }
    ```
* **μ‘λ‹µ μμ‹:**
    ```json
    {
      "userId": "testUser1",
      "point": 22000
    }
    ```

### 6. λ™μ‹μ„± ν…μ¤νΈ API

μ΄ APIλ“¤μ€ κ°λ° λ° ν…μ¤νΈ ν™κ²½μ—μ„ μ‹μ¤ν…μ λ™μ‹μ„± μ²λ¦¬ λ΅μ§μ„ κ²€μ¦ν•κΈ° μ„ν• κ²ƒμ…λ‹λ‹¤. μ‹¤μ  μ„λΉ„μ¤μ—μ„λ” μ‚¬μ©λμ§€ μ•μµλ‹λ‹¤.

#### a) λ™μ‹ ν¬μΈνΈ μ¶©μ „ ν…μ¤νΈ

* **POST** `/api/test/concurrent-charge`
* **Query Parameters (URL λ’¤μ— `?key=value&key2=value2` ν•νƒλ΅ μ¶”κ°€):**
    * `numberOfThreads`: (Integer, κΈ°λ³Έκ°’: 5) λ™μ‹μ— μ‹¤ν–‰ν•  μ¤λ λ“(μ”μ²­) μ
    * `userId`: (String, κΈ°λ³Έκ°’: "concurrentUser") μ¶©μ „ λ€μƒ μ‚¬μ©μ ID
    * `amount`: (Long, κΈ°λ³Έκ°’: 200) κ° μ”μ²­λ‹Ή μ¶©μ „ κΈμ•΅
    * `resetUserPoint`: (Boolean, κΈ°λ³Έκ°’: true) ν…μ¤νΈ μ „ μ‚¬μ©μ ν¬μΈνΈ μ΄κΈ°ν™” μ—¬λ¶€
* **μ”μ²­ μμ‹:**
    `POST http://localhost:8080/api/test/concurrent-charge?numberOfThreads=10&userId=testUser&amount=100&resetUserPoint=true`
* **μ‘λ‹µ μμ‹:**
    ```
    λ™μ‹μ„± ν…μ¤νΈ μ™„λ£: μ΄ 10ν μ”μ²­, μ„±κ³µ 1ν, μ‹¤ν¨ 9ν. μµμΆ… testUser ν¬μΈνΈ: 100
    ```
    *(μ°Έκ³ : λ‚™κ΄€μ  λ½μΌλ΅ μΈν•΄ μ„±κ³µ νμκ°€ λ‚®κ² λ‚μ¬ μ μμµλ‹λ‹¤.)*

#### b) λ™μ‹ μ£Όλ¬Έ λ° μΈκΈ° λ©”λ‰΄ μ§‘κ³„ ν…μ¤νΈ

* **POST** `/api/test/concurrent-order`
* **Query Parameters:**
    * `numberOfThreads`: (Integer, κΈ°λ³Έκ°’: 50) λ™μ‹μ— μ‹¤ν–‰ν•  μ¤λ λ“(μ£Όλ¬Έ μ”μ²­) μ
    * `userId`: (String, κΈ°λ³Έκ°’: "user001") μ£Όλ¬Έν•  μ‚¬μ©μ ID
    * `menuName`: (String, κΈ°λ³Έκ°’: "μ•„λ©”λ¦¬μΉ΄λ…Έ") μ£Όλ¬Έν•  λ©”λ‰΄ μ΄λ¦„ (μ‹¤μ  IDλ¥Ό λ™μ μΌλ΅ μ΅°νν•μ—¬ μ‚¬μ©)
    * `quantity`: (Integer, κΈ°λ³Έκ°’: 1) κ° μ£Όλ¬Έμ μλ‰
    * `resetOrdersBeforeTest`: (Boolean, κΈ°λ³Έκ°’: true) ν…μ¤νΈ μ „ λ¨λ“  μ£Όλ¬Έ/μ‚¬μ©μ/λ©”λ‰΄ λ°μ΄ν„° μ΄κΈ°ν™” μ—¬λ¶€
* **μ”μ²­ μμ‹:**
    `POST http://localhost:8080/api/test/concurrent-order?numberOfThreads=50&userId=user001&menuName=μ•„λ©”λ¦¬μΉ΄λ…Έ&quantity=1&resetOrdersBeforeTest=true`
* **μ‘λ‹µ μμ‹:**
    ```text
    === λ™μ‹ μ£Όλ¬Έ ν…μ¤νΈ κ²°κ³Ό ===
    μ΄ μ”μ²­: 50ν, μ„±κ³µ: 6ν, μ‹¤ν¨: 44ν.
    μ‹¤ν¨ μƒμ„Έ λ©”μ‹μ§€ (μµλ€ 5κ°):
      - Exception: 409 : "{"code":"CONCURRENCY_FAILURE","message":"λ™μ‹μ„± μ¶©λμ΄ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."}"
      - Exception: 409 : "{"code":"CONCURRENCY_FAILURE","message":"λ™μ‹μ„± μ¶©λμ΄ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."}"
      ... (μƒλµ)

    === μµμΆ… μΈκΈ° λ©”λ‰΄ λ©λ΅ (μµκ·Ό 7μΌκ°„ μ£Όλ¬Έ κΈ°μ¤€) ===
    - ID: 16, μ΄λ¦„: μ•„λ©”λ¦¬μΉ΄λ…Έ, μ£Όλ¬Έ νμ: 6ν
    ```
    *(μ°Έκ³ : λ‚™κ΄€μ  λ½μ— μν•΄ λ€λ¶€λ¶„μ λ™μ‹ μ£Όλ¬Έμ΄ `409 CONFLICT`λ΅ μ‹¤ν¨ν•λ©°, μµμΆ… μΈκΈ° λ©”λ‰΄ μ§‘κ³„λ” μ„±κ³µν• μ£Όλ¬Έλ§μ„ μ •ν™•ν λ°μν•©λ‹λ‹¤. λ©”λ‰΄ IDλ” `auto_increment`μ— λ”°λΌ λ‹¬λΌμ§ μ μμµλ‹λ‹¤.)*

### 7. κ³µν†µ μ—λ¬ μ‘λ‹µ ν•μ‹

API μ”μ²­ μ²λ¦¬ μ¤‘ μ¤λ¥κ°€ λ°μƒν•λ©΄ λ‹¤μκ³Ό κ°™μ€ ν•μ‹μΌλ΅ μ‘λ‹µν•©λ‹λ‹¤.

* **μμ‹:**
    ```json
    {
      "code": "INVALID_INPUT",
      "message": "μ¶©μ „ κΈμ•΅μ€ 0λ³΄λ‹¤ μ»¤μ•Ό ν•©λ‹λ‹¤."
    }
    ```
    *(μ°Έκ³ : `timestamp`μ™€ `path` ν•„λ“λ” `ErrorResponse` DTOμ— λ…μ‹μ μΌλ΅ μ¶”κ°€λμ–΄μ•Ό μ‘λ‹µμ— ν¬ν•¨λ©λ‹λ‹¤.)*

* **μ£Όμ” μ—λ¬ μ½”λ“:**
    * `INVALID_INPUT`: μ ν¨ν•μ§€ μ•μ€ μ”μ²­ λ°μ΄ν„° (HTTP 400 Bad Request)
    * `USER_NOT_FOUND`: μ”μ²­ν• μ‚¬μ©μλ¥Ό μ°Ύμ„ μ μ—†μ (HTTP 404 Not Found)
    * `MENU_NOT_FOUND`: μ”μ²­ν• λ©”λ‰΄λ¥Ό μ°Ύμ„ μ μ—†μ (HTTP 404 Not Found)
    * `INSUFFICIENT_POINT`: ν¬μΈνΈ λ¶€μ΅± (HTTP 400 Bad Request)
    * `CONCURRENCY_FAILURE`: λ™μ‹μ„± μ¶©λ λ°μƒ (HTTP 409 Conflict)
    * `INTERNAL_SERVER_ERROR`: μ„λ²„ λ‚΄λ¶€ μ¤λ¥ (HTTP 500 Internal Server Error)

---

## π€ λ΅μ»¬ κ°λ° ν™κ²½ μ„¤μ • λ° μ‹¤ν–‰

1.  **ν•„μ μ”κµ¬ μ‚¬ν•­ μ„¤μΉ:**
    * Java Development Kit (JDK) 17 μ΄μƒ
    * Maven (μ„¤μΉ κ¶μ¥, λλ” Maven Wrapper μ‚¬μ©)
2.  **ν”„λ΅μ νΈ ν΄λ΅ :**
    ```bash
    git clone [https://github.com/eodnjsdl-3254/coffee-order-system.git](https://github.com/eodnjsdl-3254/coffee-order-system.git)
    cd coffee-order-system
    ```
3.  **μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰:**
    ```bash
    ./mvnw spring-boot:run
    ```

## π§ ν…μ¤νΈ μ‹¤ν–‰

ν”„λ΅μ νΈμ λ¨λ“  ν…μ¤νΈλ” λ‹¤μ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ‹¤ν–‰ν•  μ μμµλ‹λ‹¤:

```bash
./mvnw test